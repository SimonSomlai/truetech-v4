!function(t){var e=new Array,a=new Array;t.fn.doAutosize=function(e){var a=t(this).data("minwidth"),n=t(this).data("maxwidth"),i="",o=t(this),r=t("#"+t(this).data("tester_id"));if(i!==(i=o.val())){var s=i.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");r.html(s);var d=r.width(),l=d+e.comfortZone>=a?d+e.comfortZone:a,u=o.width(),c=u>l&&l>=a||l>a&&n>l;c&&o.width(l)}},t.fn.resetAutosize=function(e){var a=t(this).data("minwidth")||e.minInputWidth||t(this).width(),n=t(this).data("maxwidth")||e.maxInputWidth||t(this).closest(".tagsinput").width()-e.inputPadding,i=t(this),o=t("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:i.css("fontSize"),fontFamily:i.css("fontFamily"),fontWeight:i.css("fontWeight"),letterSpacing:i.css("letterSpacing"),whiteSpace:"nowrap"}),r=t(this).attr("id")+"_autosize_tester";!t("#"+r).length>0&&(o.attr("id",r),o.appendTo("body")),i.data("minwidth",a),i.data("maxwidth",n),i.data("tester_id",r),i.css("width",a)},t.fn.addTag=function(n,i){return i=jQuery.extend({focus:!1,callback:!0},i),this.each(function(){var o=t(this).attr("id"),r=t(this).val().split(e[o]);if(""==r[0]&&(r=new Array),n=jQuery.trim(n),i.unique){var s=t(this).tagExist(n);1==s&&t("#"+o+"_tag").addClass("not_valid")}else var s=!1;if(""!=n&&1!=s){if(t("<span>").addClass("tag").append(t("<span>").text(n).append("&nbsp;&nbsp;"),t("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return t("#"+o).removeTag(escape(n))})).insertBefore("#"+o+"_addTag"),r.push(n),t("#"+o+"_tag").val(""),i.focus?t("#"+o+"_tag").focus():t("#"+o+"_tag").blur(),t.fn.tagsInput.updateTagsField(this,r),i.callback&&a[o]&&a[o].onAddTag){var d=a[o].onAddTag;d.call(this,n)}if(a[o]&&a[o].onChange){var l=r.length,d=a[o].onChange;d.call(this,t(this),r[l-1])}}}),!1},t.fn.removeTag=function(n){return n=unescape(n),this.each(function(){var o=t(this).attr("id"),r=t(this).val().split(e[o]);for(t("#"+o+"_tagsinput .tag").remove(),str="",i=0;i<r.length;i++)r[i]!=n&&(str=str+e[o]+r[i]);if(t.fn.tagsInput.importTags(this,str),a[o]&&a[o].onRemoveTag){var s=a[o].onRemoveTag;s.call(this,n)}}),!1},t.fn.tagExist=function(a){var n=t(this).attr("id"),i=t(this).val().split(e[n]);return jQuery.inArray(a,i)>=0},t.fn.importTags=function(e){var a=t(this).attr("id");t("#"+a+"_tagsinput .tag").remove(),t.fn.tagsInput.importTags(this,e)},t.fn.tagsInput=function(i){var o=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},i),r=0;return this.each(function(){if("undefined"==typeof t(this).attr("data-tagsinput-init")){t(this).attr("data-tagsinput-init",!0),o.hide&&t(this).hide();var i=t(this).attr("id");i&&!e[t(this).attr("id")]||(i=t(this).attr("id","tags"+(new Date).getTime()+r++).attr("id"));var s=jQuery.extend({pid:i,real_input:"#"+i,holder:"#"+i+"_tagsinput",input_wrapper:"#"+i+"_addTag",fake_input:"#"+i+"_tag"},o);e[i]=s.delimiter,(o.onAddTag||o.onRemoveTag||o.onChange)&&(a[i]=new Array,a[i].onAddTag=o.onAddTag,a[i].onRemoveTag=o.onRemoveTag,a[i].onChange=o.onChange);var d='<div id="'+i+'_tagsinput" class="tagsinput"><div id="'+i+'_addTag">';if(o.interactive&&(d=d+'<input id="'+i+'_tag" value="" data-default="'+o.defaultText+'" />'),d+='</div><div class="tags_clear"></div></div>',t(d).insertAfter(this),t(s.holder).css("width",o.width),t(s.holder).css("min-height",o.height),t(s.holder).css("height",o.height),""!=t(s.real_input).val()&&t.fn.tagsInput.importTags(t(s.real_input),t(s.real_input).val()),o.interactive){if(t(s.fake_input).val(t(s.fake_input).attr("data-default")),t(s.fake_input).css("color",o.placeholderColor),t(s.fake_input).resetAutosize(o),t(s.holder).bind("click",s,function(e){t(e.data.fake_input).focus()}),t(s.fake_input).bind("focus",s,function(e){t(e.data.fake_input).val()==t(e.data.fake_input).attr("data-default")&&t(e.data.fake_input).val(""),t(e.data.fake_input).css("color","#000000")}),void 0!=o.autocomplete_url){autocomplete_options={source:o.autocomplete_url};for(attrname in o.autocomplete)autocomplete_options[attrname]=o.autocomplete[attrname];void 0!==jQuery.Autocompleter?(t(s.fake_input).autocomplete(o.autocomplete_url,o.autocomplete),t(s.fake_input).bind("result",s,function(e,a){a&&t("#"+i).addTag(a[0]+"",{focus:!0,unique:o.unique})})):void 0!==jQuery.ui.autocomplete&&(t(s.fake_input).autocomplete(autocomplete_options),t(s.fake_input).bind("autocompleteselect",s,function(e,a){return t(e.data.real_input).addTag(a.item.value,{focus:!0,unique:o.unique}),!1}))}else t(s.fake_input).bind("blur",s,function(e){var a=t(this).attr("data-default");return""!=t(e.data.fake_input).val()&&t(e.data.fake_input).val()!=a?e.data.minChars<=t(e.data.fake_input).val().length&&(!e.data.maxChars||e.data.maxChars>=t(e.data.fake_input).val().length)&&t(e.data.real_input).addTag(t(e.data.fake_input).val(),{focus:!0,unique:o.unique}):(t(e.data.fake_input).val(t(e.data.fake_input).attr("data-default")),t(e.data.fake_input).css("color",o.placeholderColor)),!1});t(s.fake_input).bind("keypress",s,function(e){return n(e)?(e.preventDefault(),e.data.minChars<=t(e.data.fake_input).val().length&&(!e.data.maxChars||e.data.maxChars>=t(e.data.fake_input).val().length)&&t(e.data.real_input).addTag(t(e.data.fake_input).val(),{focus:!0,unique:o.unique}),t(e.data.fake_input).resetAutosize(o),!1):void(e.data.autosize&&t(e.data.fake_input).doAutosize(o))}),s.removeWithBackspace&&t(s.fake_input).bind("keydown",function(e){if(8==e.keyCode&&""==t(this).val()){e.preventDefault();var a=t(this).closest(".tagsinput").find(".tag:last").text(),n=t(this).attr("id").replace(/_tag$/,"");a=a.replace(/[\s]+x$/,""),t("#"+n).removeTag(escape(a)),t(this).trigger("focus")}}),t(s.fake_input).blur(),s.unique&&t(s.fake_input).keydown(function(e){(8==e.keyCode||String.fromCharCode(e.which).match(/\w+|[\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1,\/]+/))&&t(this).removeClass("not_valid")})}}}),this},t.fn.tagsInput.updateTagsField=function(a,n){var i=t(a).attr("id");t(a).val(n.join(e[i]))},t.fn.tagsInput.importTags=function(n,o){t(n).val("");var r=t(n).attr("id"),s=o.split(e[r]);for(i=0;i<s.length;i++)t(n).addTag(s[i],{focus:!1,callback:!1});if(a[r]&&a[r].onChange){var d=a[r].onChange;d.call(n,n,s[i])}};var n=function(e){var a=!1;return 13==e.which?!0:("string"==typeof e.data.delimiter?e.which==e.data.delimiter.charCodeAt(0)&&(a=!0):t.each(e.data.delimiter,function(t,n){e.which==n.charCodeAt(0)&&(a=!0)}),a)}}(jQuery);